<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.ProductsMapper">

        <!--enable mybatis default cache configure reference:
            https://mybatis.github.io/mybatis-3/zh/sqlmap-xml.html#cache
        -->

        <sql id="productsColumns">
                ${alias}.id,
                ${alias}.merch_uid,
                ${alias}.merch_nm,
                ${alias}.lang,
                ${alias}.cate_id,
                ${alias}.cate_nm,
                ${alias}.brand_id,
                ${alias}.brand_nm,
                ${alias}.prod_nm,
                ${alias}.prod_color,
                ${alias}.prod_size,
                ${alias}.prod_desc,
                ${alias}.store_area,
                ${alias}.src_area,
                ${alias}.sell_on_at,
                ${alias}.sell_off_at,
                ${alias}.prod_amount,
                ${alias}.prod_price,
                ${alias}.recommend_price,
                ${alias}.prod_master_img,
                ${alias}.prod_preview_imgs,
                ${alias}.prod_detail_imgs,
                ${alias}.prod_features,
                ${alias}.state,
                ${alias}.is_destory,
                ${alias}.destory_uid,
                ${alias}.update_at,
                ${alias}.update_uid,
                ${alias}.create_at,
                ${alias}.create_uid
        </sql>

        <select id="getProducts" resultType="entity.Products" parameterType="java.lang.Long">
                select
                <include refid="productsColumns">
                        <property name="alias" value="t"/>
                </include>
                from prods t where id=${value}
        </select>

        <select id="getAllProducts" parameterType="map" resultType="entity.Products">
                select
                <include refid="productsColumns">
                        <property name="alias" value="t"/>
                </include>
                from prods t where 1=1
                <if test="pageSize == -1 and offset >= -1">
                    LIMIT ALL OFFSET 0
                </if>
                <if test="pageSize >= 1 and offset >= 0">
                    LIMIT #{pageSize} OFFSET #{offset}
                </if>
        </select>

        <insert id="insertProducts" parameterType="entity.Products" useGeneratedKeys="true" keyProperty="id" >
                insert into prods
                (merch_uid,merch_nm,lang,cate_id,cate_nm,brand_id,brand_nm,prod_nm,prod_color,prod_size,prod_desc,store_area,src_area,sell_on_at,sell_off_at,prod_amount,prod_price,recommend_price,prod_master_img,prod_preview_imgs,prod_detail_imgs,prod_features,state,is_destory,destory_uid,update_at,update_uid,create_at,create_uid)
                values
                (#{merchId},#{merchName},#{language},#{cateId},#{cateName},#{brandId},#{brandName},#{productName},#{productColor},#{productSize},#{productDesc},#{storeArea},#{sourceArea},#{sellOnDate},#{sellOffDate},#{productAmount},#{productPrice},#{recommendPrice},#{masterImg},#{previewImgs},#{detailImgs},#{features},#{productState},#{destory},#{destoryUid},#{updateDate},#{updateUid},CURRENT_TIMESTAMP(0),#{createUid})
        </insert>
</mapper>
