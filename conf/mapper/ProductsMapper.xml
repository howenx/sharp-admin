<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.ProductsMapper">

        <!--enable mybatis default cache configure reference:
            https://mybatis.github.io/mybatis-3/zh/sqlmap-xml.html#cache
        -->

        <sql id="productsColumns">
                ${alias}.id,
                ${alias}.merch_uid      merchId,
                ${alias}.merch_nm       merchName,
                ${alias}.lang           lan,
                ${alias}.cate_id ,
                ${alias}.cate_nm,
                ${alias}.brand_id,
                ${alias}.brand_nm,
                ${alias}.prod_nm        productName,
                ${alias}.prod_color     productColor,
                ${alias}.prod_size      productSize,
                ${alias}.prod_desc      productDesc,
                ${alias}.store_area     storeArea,
                ${alias}.src_area       sourceArea,
                ${alias}.sell_on_at     sellOnDate,
                ${alias}.sell_off_at    sellOffDate,
                ${alias}.prod_amount    productAmount,
                ${alias}.prod_price     productPrice,
                ${alias}.recommend_price recommendPrice,
                ${alias}.prod_master_img        masterImg,
                ${alias}.prod_preview_imgs      previewImgs,
                ${alias}.prod_detail_imgs       detailImgs,
                ${alias}.prod_features          features,
                ${alias}.state                  state,
                ${alias}.or_destory             destory,
                ${alias}.destory_uid,
                ${alias}.update_at,
                ${alias}.update_uid,
                ${alias}.create_at,
                ${alias}.create_uid
        </sql>

        <select id="getProducts" resultType="entity.Products" parameterType="java.lang.Long">
                select
                <include refid="productsColumns">
                        <property name="alias" value="t"/>
                </include>
                from prods t where id=${value}
        </select>

        <select id="getAllProducts" parameterType="entity.Products" resultType="entity.Products">
                select
                <include refid="productsColumns">
                        <property name="alias" value="t"/>
                </include>
                from prods t where 1=1
                <if test="id != null">
                        and t.id = #{id}
                </if>
                <if test='productName != null and productName != "null" and productName != "" '>
                        and t.prod_nm = #{productName}
                </if>
                <if test='sellOnDate != null'>
                        and t.sell_on_at &gt;= #{sellOnDate} ::timestamp
                </if>
                <if test='sellOffDate != null'>
                        and t.sell_off_at  &lt;= #{sellOffDate} ::timestamp
                </if>
                <if test="sort == null or sort == '' or sort == 'null' ">
                        ORDER BY t.id DESC, t.prod_nm
                </if>

                <if test="sort != null and sort != '' and sort != 'null' ">
                        ORDER BY t.${sort}
                        <if test="order != null">
                                ${order}
                        </if>
                </if>
                <if test="pageSize == -1 and offset >= -1">
                        LIMIT ALL OFFSET 0
                </if>
                <if test="pageSize >= 1 and offset >= 0">
                        LIMIT #{pageSize} OFFSET #{offset}
                </if>
        </select>

        <insert id="insertProducts" parameterType="entity.Products" useGeneratedKeys="true" keyProperty="id" >
                insert into prods
                (merch_uid,merch_nm,lang,cate_id,cate_nm,brand_id,brand_nm,prod_nm,prod_color,prod_size,prod_desc,store_area,src_area,sell_on_at,sell_off_at,prod_amount,prod_price,recommend_price,prod_master_img,prod_preview_imgs,prod_detail_imgs,prod_features,state,or_destory,destory_uid,update_at,update_uid,create_at,create_uid)
                values
                (#{merchId},#{merchName},#{language},#{cateId},#{cateName},#{brandId},#{brandName},#{productName},#{productColor},#{productSize},#{productDesc},#{storeArea},#{sourceArea},#{sellOnDate},#{sellOffDate},#{productAmount},#{productPrice},#{recommendPrice},#{masterImg},#{previewImgs},#{detailImgs},#{features},#{productState},#{destory},#{destoryUid},#{updateDate},#{updateUid},CURRENT_TIMESTAMP(0),#{createUid})
        </insert>
</mapper>
