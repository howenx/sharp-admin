@import play.i18n._
@(item:entity.Item,invList:List[Array[Object]],cates:entity.Cates,pCateNm:String, brands:entity.Brands,url:String, lang:String="cn", user:entity.User)

@scripts = {

<!-- UEdit -->
<script type="text/javascript" charset="utf-8" src="/assets/editorphp/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="/assets/editorphp/ueditor.all.js"></script>
<!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
<!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
<script type="text/javascript" charset="utf-8" src="/assets/editorphp/lang/zh-cn/zh-cn.js"></script>
<script type="text/javascript" charset="utf-8" src="/assets/editorphp/lang/en/en.js"></script>

<link rel="stylesheet" href="/assets/css/slider.css"/>
<link rel="stylesheet" href="/assets/css/item.css"/>
<script>
     /** 图片放大和关闭的功能 **/
    $(document).on("click", ".main-img", function(e) {
        $(".goods-img-bg").css({
            "height": $(window).height(),
            "display": "block"
        });
        $(".goods-img").css("left", ($(window).width() - 1200) / 2);
        $(this).clone().appendTo($(".goods-img")).css({
            "width": "80%",
            "height":"600px",
            "z-index": 1000
        });
    });
    $(document).on("click", ".goods-img-bg .close", function(e) {
        $(".goods-img-bg img").remove();
        $(".goods-img-bg").css({
            "display": "none"
        });
    });
    $(document).on("click", ".goods-bg", function(e) {
        $(".goods-img-bg img").remove();
        $(".goods-img-bg").css({
            "display": "none"
        });
    });
</script>
}

@import java.lang.String; var title="商品详情"

@layout(lang=lang,title=title,user=user)(scripts) {
<div style="width: 50%;margin: 10px auto;display:none;" class="alert alert-success" role="alert">
    <strong>Well done!</strong>
    @if(flash.containsKey("success")) {
    @flash.get("success")
    }
    <span class="close" aria-label="Close"><span aria-hidden="true">&times;</span></span>
</div>

<div class="mbread" style="width:80%">
    <div class="bread-path">
        <span class="index">@Messages.get(new Lang(Lang.forCode(lang)),"page.head.path.title")</span>
        <a href="/@lang/summary"><span class="current">@Messages.get(new Lang(Lang.forCode(lang)),"nav.home")</span></a>
        <span class="icon-path">&gt;</span>
        <span class="current">@Messages.get(new Lang(Lang.forCode(lang)),"nav.products")</span>
        <span class="icon-path">&gt;</span>
        <span>商品详情</span>
    </div>
</div>
<div class="wrap-slider">
    <div class="page-title">
        <span class="title-name">商品详情</span>
    </div>
    <div class="usercenter-option">
        <div  id="updateItem" class="btn-blue btn-form fr ml15">修改</div>
        <div id="return" class="btn-white btn-form fr ml20">返回</div>
        <span id="js-userinfo-error" class="mt20 alt fr"></span>
    </div>
    <div class="row">
        <form class="form-horizontal" method="post"   enctype="multipart/form-data">
        <div class="upinfo">
            <input type="hidden" id="itemId" name="itemId" value="@item.getId()"/>
            <!-- 商品基本信息 -->
            <h4 class="h4-custom-hmm">@Messages.get(new Lang(Lang.forCode(lang)),"item.add.basics")</h4>
            <div class="form-group">
                <label class="col-sm-1 control-label" ><div class="r" style="padding:3px;"> *</div><div class="r">@Messages.get(new Lang(Lang.forCode(lang)),"item.add.cate")</div></label>
                <div class="col-sm-2">
                    <input class="form-control" value="@pCateNm" readonly/>
                </div>
                <div class="col-sm-2" id="divDynamicSubCates">
                    <input class="form-control" value="@cates.getCateNm()" readonly/>
                </div>
                <label class="col-sm-1 control-label" ><div class="r" style="padding:3px;"> *</div><div class="r">@Messages.get(new Lang(Lang.forCode(lang)),"item.add.brand")</div></label>
                <div class="col-sm-2">
                    <input class="form-control" value="@brands.getBrandNm()" readonly/>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-1 control-label" ><div class="r" style="padding:3px;"> *</div><div class="r">商品标题</div></label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" id="itemTitle" name="itemTitle" value="@item.getItemTitle()" readonly>
                </div>
                <label class="col-sm-1 control-label" ><div class="r" style="padding:3px;"> *</div><div class="r">@Messages.get(new Lang(Lang.forCode(lang)),"item.add.merchName")</div></label>
                <div class="col-sm-2">
                    <input type="text" class="form-control" id="supplyMerch" name="supplyMerch" value="@item.getSupplyMerch()" readonly>
                </div>
            </div>
            <!-- 商品库存信息-->
            <h4 class="h4-custom-hmm">商品库存信息</h4>
            <div class="form-group">
                <div class="col-sm-12">
                    <div class="goods-info1">
                        <table class="table table-bordered qubian inv" id="inventory">
                            <tr>
                                <th>是否主商品</th>
                                <th>颜色分类</th>
                                <th>尺寸分类</th>
                                <th>重量(整数:克)</th>
                                <th>库存总量</th>
                                <th>剩余库存</th>
                                <th>现价(￥)</th>
                                <th>原价(￥)</th>
                                <th>成本价(￥)</th>
                                <th>折扣</th>
                                <th>限购数量</th>
                                <th>运费设置</th>
                                <th>税率/税号</th>
                                <th>库存区域</th>
                                <th>报关单位</th>
                                <th>海关商品备案号</th>
                                <th>主图(一张)</th>
                                <th>详情页预览图(最多6张)</th>
                                <th>状态</th>
                            </tr>
                            @for(obj <-  invList) {
                                <tr>
                                    <td>
                                        <input type="radio" name="orMasterInv" checked="checked" class="master-radio" value="@obj(0)" disabled/>
                                    </td>
                                    <td>@obj(1)</td>
                                    <td>@obj(2)</td>
                                    <td>@obj(3)</td>
                                    <td>@obj(4)</td>
                                    <td>@obj(20)</td>
                                    <td>@obj(5)</td>
                                    <td>@obj(6)</td>
                                    <td>@obj(7)</td>
                                    <td>@obj(8)</td>
                                    <td>@obj(9)</td>
                                    <td>@obj(11)</td>
                                    <td>
                                        @if(obj(12)!= "" && null != obj(12)  ) { @obj(12)}
                                        @if(obj(13)!= "" && null != obj(13)  ) { @obj(13)}
                                    </td>
                                    <td>
                                        @if(obj(14)== "H") {杭州保税仓备货}
                                        @if(obj(14)== "HZ") {杭州保税仓直邮}
                                        @if(obj(14)== "G") {广州保税仓备货}
                                        @if(obj(14)== "GZ") {广州保税仓直邮}
                                        @if(obj(14)== "S") {上海保税仓备货}
                                        @if(obj(14)== "SZ") {上海保税仓直邮}
                                        @if(obj(14)== "K") {海外直邮}
                                    </td>
                                    <td>
                                        @if(obj(15)== "shanghai") {上海海关}
                                        @if(obj(15)== "hangzhou") {杭州海关}
                                        @if(obj(15)== "guangzhou") {广州海关}
                                    </td>
                                    <td>
                                        @for(recordCode <- obj(19).toString().substring(1,obj(19).toString().length-1).split(", ")) {
                                        @if(recordCode.substring(1,recordCode.indexOf(":")-1)=="hangzhou") {
                                        <div class="record"><span>杭州 <input type="text" value='@recordCode.substring(recordCode.indexOf(":")+3,recordCode.length-1)' name="recordHZ" style="width:70%;border:0px;"></span></div>
                                        }
                                        @if(recordCode.substring(1,recordCode.indexOf(":")-1)=="guangzhou") {
                                        <div class="record"><span>广州 <input type="text" value='@recordCode.substring(recordCode.indexOf(":")+3,recordCode.length-1)' name="recordGZ" style="width:70%;border:0px;"></span></div>
                                        }
                                        @if(recordCode.substring(1,recordCode.indexOf(":")-1)=="shanghai") {
                                        <div class="record"><span>上海 <input type="text" value='@recordCode.substring(recordCode.indexOf(":")+3,recordCode.length-1)' name="recordSH" style="width:70%;border:0px;"></span></div>
                                        }
                                        }
                                    </td>
                                    <td class="list-img">
                                        <div >
                                            <div>
                                                <img class="main-img" src='@url@obj(16).toString.substring(1,obj(16).toString.length-1).split(",")(0).substring(7,obj(16).toString.substring(1,obj(16).toString.length-1).split(",")(0).length-1)' alt="">
                                            </div>
                                        </div>
                                    </td>
                                    <td width="146" class="preview-img">
                                        <div >
                                            @for(pre <- obj(17).toString().substring(1,obj(17).toString().length()-2).split("}, ")) {
                                                <div>
                                                    <img class="main-img" src='@url@pre.substring(1,pre.length).split(", ")(0).substring(8,pre.substring(1,pre.length).split(", ")(0).length-1)' alt="">
                                                </div>
                                            }
                                        </div>
                                    </td>
                                    <td>
                                        @if(obj(18)== "Y") {正常}
                                        @if(obj(18)== "D") {下架}
                                        @if(obj(18)== "K") {售空}
                                    </td>
                                </tr>
                            }
                        </table>
                    </div>
                </div>
            </div>
            <h4 class="h4-custom-hmm">商品设置及详情</h4>
            <div class="form-group" style="margin-top:20px;">
                <label class="col-sm-1 control-label"><div class="r" style="padding:3px;"> *</div><div class="r">商品参数</div></label>
                <div class="col-sm-7" >
                    <input type="hidden" class="form-control" id="features" name="features">
                    <input type="hidden" id="del" value='@Messages.get(new Lang(Lang.forCode(lang)),"item.add.delete")'>
                    <table class="table table-bordered qubian feature" id="tabFea">
                        <tr>
                            <td>@Messages.get(new Lang(Lang.forCode(lang)),"item.add.featureName")</td>
                            <td width=500px>@Messages.get(new Lang(Lang.forCode(lang)),"item.add.featureValue")</td>
                        </tr>
                        @for(itemFeature <- item.getItemFeatures.substring(1,item.getItemFeatures.length-1).split(", ")) {
                        <tr>
                            <td><input type="text" name="attrN" value='@itemFeature.substring(1,itemFeature.indexOf(":")-1)'/></td>
                            <td><input type="text" name="attrV" value='@itemFeature.substring(itemFeature.indexOf(":")+3,itemFeature.length-1)'/></td>
                        </tr>
                        }
                    </table>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-1 control-label"><div class="r" style="padding:3px;"> *</div>优惠信息</label>
                <div class="col-sm-3">
                    <table class="table table-bordered pub" id="publicityTab">
                        @for(pub <- item.getPublicity().substring(1,item.getPublicity().length()-1).split(", ")) {
                        <tr>
                            <td>@(pub.substring(1,pub.length()-1))</td>
                        </tr>
                        }
                    </table>
                </div>
            </div>
            <!--<div class="form-group">-->
                <!--<label class="col-sm-1 control-label" ><div class="r">商品状态</div></label>-->
                <!--<div class="col-sm-3">-->
                <!--@if(item.getState()=="Y"){<input class="form-control" type="text" name="state" value="正常" readonly/>}-->
                <!--@if(item.getState()=="D"){<input class="form-control" type="text" name="state" value="下架" readonly/>}-->
                <!--@if(item.getState()=="K"){<input class="form-control" type="text" name="state" value="售空" readonly/>}-->
                <!--</div>-->
            <!--</div>-->
            @if(item.getItemDetailImgs()!=null && item.getItemDetailImgs()!="") {
            <div class="form-group">
                <!--<label class="col-sm-1 control-label"><div class="r" style="padding:3px;">*</div><div class="r">主题宣传图</div><div style="margin-top:20px;margin-right:30px;">(一张)</div></label>-->
                <!--<div class="col-sm-2">-->
                    <!--<div class="master-img" style="border:1px solid #ccc; height:80px;">-->
                        <!--<div id="galleryT" style="margin-top:15px;margin-left:10px;">-->
                            <!--<div>-->
                                <!--<img class="main-img" src="@url@item.getItemMasterImg()" alt="">-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                <!--</div>-->
                <label class="col-sm-1 control-label"><div class="r" style="padding:3px;"> *</div><div class="r">@Messages.get(new Lang(Lang.forCode(lang)),"item.add.detailImgs")</div></label>
                <div class="col-sm-4">
                    <div class="detail-img" style="border:1px solid #ccc;">
                        <div id="galleryD" style="margin-bottom:10px;margin-top:15px;">
                            @for(detail <- item.getItemDetailImgs().substring(1,item.getItemDetailImgs().length()-2).split("], ")) {
                            <div style="display:inline-block; border:1px solid #ccc" >
                                @for(d <- detail.substring(1,detail.length()).split(", ")) {
                                <img src="@url@d.substring(1,d.length()-1)" alt="" style="border:0px;height:13.3px;display:block;margin-top:0px;margin-bottom:0px;">
                                }
                            </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
            }
            @if(item.getItemNotice()!=null && item.getItemNotice()!="") {
            <div class="form-group">
                <label class="col-sm-1 control-label" ><div class="r">重要通告</div></label>
                <div class="col-sm-3">
                    <textarea rows="6"  class="form-control" id="itemNotice" name="itemNotice"  readonly>@item.getItemNotice()</textarea>
                </div>
            </div>
            }
            @if(item.getItemDetail()!=null && item.getItemDetail()!="") {
            <div class="form-group">
                <label class="col-sm-1 control-label"><div class="r" style="padding:3px;"> *</div><div class="r">商品详情</div></label>
                <div class="col-sm-7">
                    <script id="editor" type="text/plain" style="height:500px;" ></script>
                    <input type="hidden" id="itemDetail" value="@item.getItemDetail()">
                </div>
            </div>
            }
        </div>
        </form>
    </div>
</div>

<div class="goods-img-bg">
    <div class="goods-bg"></div>
    <div class="goods-img">
        <button type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    </div>
</div>
}

<script>

    /**页面加载时UEdit初始化数据**/
     window.onload=function() {
        setTimeout("UE.getEditor('editor').setContent(itemDetail, false)",500);
     };

    //实例化编辑器
    //建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
    var ue = UE.getEditor('editor');
    var itemDetail = $("#itemDetail").val();

    /** 点击修改按钮,进入修改页面 **/
	$("#updateItem").on("click", function() {
	    location.href="/"+window.lang+"/comm/updateById/"+$("#itemId").val();
	});

	/** 点击返回按钮,返回到列表查询页面 **/
	$("#return").on("click", function() {
	    location.href="/"+window.lang+"/comm/search";
	});

</script>