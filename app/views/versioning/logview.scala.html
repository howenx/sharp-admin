@import play.i18n.Messages, play.i18n.Lang
@(lang: String = "cn", user: domain.User)

@scripts = {
    <link rel="stylesheet" href="/assets/css/slider.css">
    <link rel="stylesheet" href="/assets/css/screenshot.css">
    <link rel="stylesheet" href="/assets/css/search.css">
    <script type="text/javascript" src="/assets/js/jquery.form.min.js"></script>

    <script>
            Date.prototype.format = function(format) {
                var date = {
                    "M+": this.getMonth() + 1,
                    "d+": this.getDate(),
                    "h+": this.getHours(),
                    "m+": this.getMinutes(),
                    "s+": this.getSeconds(),
                    "q+": Math.floor((this.getMonth() + 3) / 3),
                    "S+": this.getMilliseconds()
                };
                if (/(y+)/i.test(format)) {
                    format = format.replace(RegExp.$1, (this.getFullYear() + '').substr(4 - RegExp.$1.length));
                }
                for (var k in date) {
                    if (new RegExp("(" + k + ")").test(format)) {
                        format = format.replace(RegExp.$1, RegExp.$1.length == 1
                                ? date[k] : ("00" + date[k]).substr(("" + date[k]).length));
                    }
                }
                return format;
            }

            $(".order-option>div").hover(function () {
                $(this).css("color", "#fff");
            }, function () {
                $(this).css("color", "#333");
                $(".currect").css("color", "#fff");
            }).click(function () {
                var index = $(this).index(".order-option>div");
                $(".currect").css("color", "#333");
                $(".order-option>div").removeClass("currect");
                $(this).addClass("currect");
                $(".order-admin table").hide();
                $(".btn-submit").hide();
                $(".order-admin table").eq(index).show();
                $(".btn-submit").eq(index).show();
            })
            var wsUri = "@routes.VersionCtrl.logsocket("admin").webSocketURL()";
            var output;

            var WS = window['MozWebSocket'] ? MozWebSocket : WebSocket;
            var dateSocket = new WS(wsUri);

            var receiveEvent = function (event) {

                var data = JSON.parse(JSON.stringify(event.data));

                console.log(data.level);

//                var level = JSON.parse(JSON.stringify(data.level));

                var tr = '<tr>' +
                        '<td rowspan="2" style="width: 20%;">' +
                        '<span style="background: rgb(219,82,75);color: #f5f5f5;padding: 2px">'+data.level+'</span>' +
                        '</td>' +
                        '<td>'+new Date(data.timeStamp).format('yyyy-MM-dd hh:mm:ss')+'</td>' +
                        '<td>'+data.loggerName+'</td>' +
                        '<td>'+data.threadName+'</td>' +
                        '</tr>' +
                        '<tr>' +
                        '<td colspan="3" style="text-align: left">' +
                        '<span style="font-weight: 700">Message:</span>' +data.formattedMessage+
                        '</td>' +
                        '</tr>';


                $("#style-admin-tbody").append(tr);
            };

            dateSocket.onmessage = receiveEvent;

    </script>
}


@layout(lang = lang, title = "日志查看", user = user)(scripts) {

    <div class="mbread">
        <div class="bread-path">
            <span class="index">@Messages.get(Lang.forCode(lang), "page.head.path.title")</span>
            <a href="/@lang/summary"><span class="current">@Messages.get(Lang.forCode(lang), "nav.home")</span></a>
            <span class="icon-path">&gt;</span>
            <span class="current">应用管理</span>
            <span class="icon-path">&gt;</span>
            <span class="current">日志查看</span>
        </div>
    </div>
    <div class="wrap-slider">
        <div class="page-title">
            <span class="title-name">日志查看</span>
        </div>
        <div class="usercenter-option">
            <div class="user-state fl">@Messages.get(Lang.forCode(lang), "themes.slider.state1")</div>
            <div id="js-usercenter-submit" class="btn-blue btn-form fr ml15">@Messages.get(Lang.forCode(lang), "themes.slider.save")</div>
            <div id="js-usercenter-cancel" class="btn-white btn-form fr ml20">@Messages.get(Lang.forCode(lang), "themes.slider.cancel")</div>
            <span id="js-userinfo-error" class="mt20 alt fr"></span>
        </div>

        <div class="row order-admin">
            <div class="col-sm-12">
                <div id="output">
                    <div class="col-sm-1 order-option" style="width: 145px">
                        <div class="currect">style-admin</div>
                        <div>style-services</div>
                        <div>style-shopping</div>
                        <div>style-message</div>
                        <div>style-promotion</div>
                        <div>style-id</div>
                        <div>style-web</div>
                        <div>style-coupon</div>
                    </div>
                    <div class="col-sm-10" style="border-left: 1px solid #ccc">
                        <h3 style="margin-bottom: 20px">Login report 2/2/2 <span>All logs</span></h3>
                        <div class="row" style="margin-bottom: 15px">
                            <div class="col-sm-offset-5 col-sm-3">
                                <span style="float: left;
                                    line-height: 34px;
                                    padding-right: 5px">level</span>
                                <select name="" id="" class="form-control" style="width: 80%">
                                    <option value="">--all--</option>
                                    <option value="">INFO</option>
                                    <option value="">DEBUG</option>
                                    <option value="">WARN</option>
                                    <option value="">ERROR</option>
                                </select>
                            </div>
                            <div class="col-sm-2">
                                <button type="button" class="btn btn-primary btn-block" style="padding: 4px 12px">增加</button>
                            </div>
                            <div class="col-sm-2">
                                <button type="button" class="btn btn-danger btn-block" style="padding: 4px 12px">删除</button>
                            </div>
                        </div>
                            <!--1-->
                        <table id="style-admin-tb" class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th>Level</th>
                                    <th>Time</th>
                                    <th>Type</th>
                                    <th>File</th>
                                </tr>
                            </thead>
                            <tbody id="style-admin-tbody">
                            </tbody>
                        </table>
                            <!--2-->
                        <table class="table table-striped table-bordered" style="display: none">
                            <thead>
                                <tr>
                                    <th>Level</th>
                                    <th>Time</th>
                                    <th>Type</th>
                                    <th>File</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td rowspan="2">
                                        <span style="background: rgb(219, 82, 75);
                                            color: #f5f5f5;
                                            padding: 2px">ERROR</span>
                                    </td>
                                    <td>123</td>
                                    <td>123</td>
                                    <td>123</td>
                                </tr>
                                <tr>
                                    <td colspan="3" style="text-align: left">
                                        <span style="font-weight: 700">Message:</span>
                                        01.php
                                    </td>
                                </tr>
                                <tr>
                                    <td rowspan="2">
                                        <span style="background: rgb(219, 82, 75);
                                            color: #f5f5f5;
                                            padding: 2px">ERROR</span>
                                    </td>
                                    <td>123</td>
                                    <td>123</td>
                                    <td>123</td>
                                </tr>
                                <tr>
                                    <td colspan="3" style="text-align: left">
                                        <span style="font-weight: 700">Message:</span>
                                        02.php
                                    </td>
                                </tr>

                            </tbody>
                        </table>
                            <!--3-->
                        <table class="table table-striped table-bordered" style="display: none">
                            <thead>
                                <tr>
                                    <th>Level</th>
                                    <th>Time</th>
                                    <th>Type</th>
                                    <th>File</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td rowspan="2">
                                        <span style="background: rgb(219, 82, 75);
                                            color: #f5f5f5;
                                            padding: 2px">ERROR</span>
                                    </td>
                                    <td>123</td>
                                    <td>123</td>
                                    <td>123</td>
                                </tr>
                                <tr>
                                    <td colspan="3" style="text-align: left">
                                        <span style="font-weight: 700">Message:</span>
                                        01.php
                                    </td>
                                </tr>
                                <tr>
                                    <td rowspan="2">
                                        <span style="background: rgb(219, 82, 75);
                                            color: #f5f5f5;
                                            padding: 2px">ERROR</span>
                                    </td>
                                    <td>123</td>
                                    <td>123</td>
                                    <td>123</td>
                                </tr>
                                <tr>
                                    <td colspan="3" style="text-align: left">
                                        <span style="font-weight: 700">Message:</span>
                                        02.php
                                    </td>
                                </tr>
                                <tr>
                                    <td rowspan="2">
                                        <span style="background: rgb(219, 82, 75);
                                            color: #f5f5f5;
                                            padding: 2px">ERROR</span>
                                    </td>
                                    <td>123</td>
                                    <td>123</td>
                                    <td>123</td>
                                </tr>
                                <tr>
                                    <td colspan="3" style="text-align: left">
                                        <span style="font-weight: 700">Message:</span>
                                        03.php
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
